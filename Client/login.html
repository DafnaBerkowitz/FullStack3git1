<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="login.css">

    <title>login</title>
</head>
<body>
    

<h1 id="welcome">WELCOME</h1>
<button id="loginButton" onclick="openForm()"> LogIn</button>           

<div class="div-sign-in-up" id="sign-in">

    <form action="/action_page.php" class="form" id="login">
        <h1 class="form__title">Login</h1>
        <div class="form__message form__message--error"></div>
        <div class="form__input-group">
            <input type="text" id="email" class="form__input" autofocus placeholder="email">
            <div class="form__input-error-message"></div>
        </div>
        <div class="form__input-group">
            <input type="password" id="password" class="form__input" autofocus placeholder="Password">
            <div class="form__input-error-message"></div>
        </div>
        <button class="form__button" type="button" onclick=OnclickSignIn()>Continue</button>   
        <p class="form__text">
            <a href="#" class="form__link">Forgot your password?</a>
        </p>
     
        <p class="form__text">
            <a class="form__link" href="./" id="linkCreateAccount">Don't have an account? Create account</a>
        </p>
    </form>

    <form class="form form--hidden" id="createAccount">
        <h1 class="form__title">Create Account</h1>
        <div class="form__message form__message--error"></div>
        <div class="form__input-group">
            <input type="text" id="signupUsername" class="form__input" autofocus placeholder="Username">
            <div class="form__input-error-message"></div>
        </div>
        <div class="form__input-group">
            <input type="text" id="emailCreate" class="form__input" autofocus placeholder="Email Address">
            <div class="form__input-error-message"></div>
        </div>
        <div class="form__input-group">
            <input type="password" id="pass1" class="form__input" autofocus placeholder="Password">
            <div class="form__input-error-message"></div>
        </div>
        <div class="form__input-group">
            <input type="password" id="pass2" class="form__input" autofocus placeholder="Confirm password">
            <div class="form__input-error-message"></div>
        </div>
        <button class="form__button" type="button" onclick=onClickNewUserfunc()>Continue</button>
        <p class="form__text">
            <a class="form__link" href="./" id="linkLogin">Already have an account? Sign in</a>
        </p>
    </form>
</div>

<script src="login.js"></script>
<script>

    function openForm(){
        document.getElementById("sign-in").style.display = "block";

    }
    function OnclickSignIn() {
        var email1 = document.getElementById("email").value;
        var password = document.getElementById("password").value;
        var users = JSON.parse(localStorage.getItem("users")) ?? [];
        if (users === []) {

            setFormMessage(document.querySelector("#login"), "error", "this user not exits");

        }


        else {
            var jUser = users.find(i => i.email === email1) ?? null;
            if (jUser === null)
                setFormMessage(document.querySelector("#login"), "error", "this user not exits");

            else if (jUser.password === password) {
                const user = {
                    name: jUser.name,
                    email: email1,
                    password: password,
                    ScoreBreak: 0,
                    ScoreMemory: 0,

                }
                window.localStorage.setItem("CurrenUser",JSON.stringify(user));
                window.location.href = "home.html";

            }

            else {
                alert("not good!");
                setFormMessage(loginForm, "error", "Invalid username/password combination");
            }
        }
    }
</script>
<script>
    function onClickNewUserfunc() {
        var username = document.getElementById("signupUsername").value;
        var email = document.getElementById("emailCreate").value;
        var pass = document.getElementById("pass1").value;
        var pass2 = document.getElementById("pass2").value;
        var users = JSON.parse(localStorage.getItem("users")) ?? [];
    
        if (users.find(i => i.email === email)) {
            alert("Email address is taking");
            return;
        }

        if (username != "") {
            if (email != "" && pass != "" && pass2 != "") {
                if (pass.match(pass2)) {
                    const user = {
                        name: username,
                        email: email,
                        password: pass,
                        ScoreBreak: 0,
                        ScoreMemory: 0,
                    }
                    users.push(user);
                    window.localStorage.setItem("users", JSON.stringify(users));
                    alert("Welcome!");


                }
                else alert("check your password");
            }
            else alert("One or more fields are empty!");


        }
    }
</script>
<script>
    function clean() {
        localStorage.clear();
    }
</script>
</body>
</html>